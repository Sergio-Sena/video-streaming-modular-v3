<!DOCTYPE html>
<html>
<head>
    <title>Teste Externo - V√≠deos S3</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        video { width: 100%; max-width: 600px; margin: 20px 0; border: 2px solid #ccc; }
        .test { margin: 30px 0; padding: 20px; border: 1px solid #ddd; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üé¨ Teste Externo - V√≠deos Drive Online</h1>
    <p><strong>Este teste est√° FORA da aplica√ß√£o React para verificar se o problema √© CORS.</strong></p>
    
    <div class="test">
        <h3>1. CloudFront URL</h3>
        <video id="video1" controls preload="metadata">
            <source src="https://d2gikqc9umroy8.cloudfront.net/users/user-sergio-sena/1756853751-Video automacao.mp4" type="video/mp4">
            Seu navegador n√£o suporta v√≠deo HTML5.
        </video>
        <div id="status1" class="status">Carregando...</div>
    </div>
    
    <div class="test">
        <h3>2. S3 Direto</h3>
        <video id="video2" controls preload="metadata">
            <source src="https://drive-online-storage.s3.amazonaws.com/users/user-sergio-sena/1756853751-Video automacao.mp4" type="video/mp4">
            Seu navegador n√£o suporta v√≠deo HTML5.
        </video>
        <div id="status2" class="status">Carregando...</div>
    </div>
    
    <div class="test">
        <h3>3. Teste com Presigned URL</h3>
        <button onclick="testPresigned()">Gerar e Testar Presigned URL</button>
        <video id="video3" controls preload="metadata" style="display:none;">
            Seu navegador n√£o suporta v√≠deo HTML5.
        </video>
        <div id="status3" class="status">Clique no bot√£o para testar</div>
    </div>
    
    <div class="test">
        <h3>4. V√≠deo Local (Controle)</h3>
        <video id="video4" controls preload="metadata">
            <source src="/sample-video.mp4" type="video/mp4">
            Seu navegador n√£o suporta v√≠deo HTML5.
        </video>
        <div id="status4" class="status">Carregando...</div>
    </div>

    <script>
        // Fun√ß√£o para monitorar status do v√≠deo
        function setupVideoMonitoring(videoId, statusId) {
            const video = document.getElementById(videoId);
            const status = document.getElementById(statusId);
            
            video.addEventListener('loadstart', () => {
                status.textContent = 'Iniciando carregamento...';
                status.className = 'status';
            });
            
            video.addEventListener('loadedmetadata', () => {
                status.textContent = `‚úÖ SUCESSO! Dura√ß√£o: ${Math.round(video.duration)}s`;
                status.className = 'status success';
            });
            
            video.addEventListener('canplay', () => {
                status.textContent += ' - Pronto para reproduzir!';
            });
            
            video.addEventListener('error', (e) => {
                const error = e.target.error;
                let errorMsg = 'Erro desconhecido';
                
                if (error) {
                    switch(error.code) {
                        case error.MEDIA_ERR_ABORTED:
                            errorMsg = 'Carregamento abortado';
                            break;
                        case error.MEDIA_ERR_NETWORK:
                            errorMsg = 'Erro de rede';
                            break;
                        case error.MEDIA_ERR_DECODE:
                            errorMsg = 'Erro de decodifica√ß√£o';
                            break;
                        case error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                            errorMsg = 'Formato n√£o suportado ou URL inv√°lida';
                            break;
                    }
                }
                
                status.textContent = `‚ùå ERRO: ${errorMsg}`;
                status.className = 'status error';
            });
            
            video.addEventListener('stalled', () => {
                status.textContent += ' (Carregamento travado)';
            });
        }
        
        // Configurar monitoramento para todos os v√≠deos
        setupVideoMonitoring('video1', 'status1');
        setupVideoMonitoring('video2', 'status2');
        setupVideoMonitoring('video3', 'status3');
        setupVideoMonitoring('video4', 'status4');
        
        // Fun√ß√£o para testar presigned URL
        async function testPresigned() {
            const status3 = document.getElementById('status3');
            const video3 = document.getElementById('video3');
            
            try {
                status3.textContent = 'Gerando presigned URL...';
                status3.className = 'status';
                
                // Simular gera√ß√£o de presigned URL (voc√™ pode substituir por uma real)
                const response = await fetch('https://g1laj6w194.execute-api.us-east-1.amazonaws.com/prod/files/users%2Fuser-sergio-sena%2F1756853751-Video%20automacao.mp4/download-url', {
                    headers: {
                        'Authorization': 'Bearer ' + (localStorage.getItem('token') || 'test-token')
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    video3.src = data.downloadUrl;
                    video3.style.display = 'block';
                    video3.load();
                    status3.textContent = 'Presigned URL gerada, testando...';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                status3.textContent = `‚ùå Erro ao gerar presigned URL: ${error.message}`;
                status3.className = 'status error';
            }
        }
        
        // Log adicional para debug
        console.log('Teste externo iniciado');
        console.log('Origin:', window.location.origin);
        console.log('User Agent:', navigator.userAgent);
    </script>
</body>
</html>