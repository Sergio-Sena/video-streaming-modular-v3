<!DOCTYPE html>
<html>
<head>
    <title>Debug Network</title>
</head>
<body>
    <h1>Debug Network Requests</h1>
    <button onclick="debugAuth()">Debug Auth</button>
    <div id="results"></div>
    
    <script>
        function log(msg) {
            document.getElementById('results').innerHTML += '<p>' + msg + '</p>';
            console.log(msg);
        }
        
        async function debugAuth() {
            document.getElementById('results').innerHTML = '';
            
            // 1. Verificar localStorage atual
            log('=== VERIFICANDO LOCALSTORAGE ===');
            const token = localStorage.getItem('auth_token');
            const user = localStorage.getItem('auth_user');
            log('Token: ' + (token ? token.substring(0, 50) + '...' : 'NULL'));
            log('User: ' + (user ? 'EXISTS' : 'NULL'));
            
            if (!token) {
                log('❌ Nenhum token encontrado. Fazendo login...');
                
                // Fazer login
                const loginResponse = await fetch('https://g1laj6w194.execute-api.us-east-1.amazonaws.com/prod/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'senanetworker@gmail.com',
                        password: 'sergiosena'
                    })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    localStorage.setItem('auth_token', loginData.token);
                    localStorage.setItem('auth_user', JSON.stringify(loginData.user));
                    log('✅ Login OK, token salvo');
                } else {
                    log('❌ Login falhou: ' + loginResponse.status);
                    return;
                }
            }
            
            // 2. Testar requisição com headers detalhados
            log('=== TESTANDO REQUISIÇÃO ===');
            const currentToken = localStorage.getItem('auth_token');
            
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentToken}`
            };
            
            log('Headers enviados:');
            log('- Content-Type: ' + headers['Content-Type']);
            log('- Authorization: Bearer ' + (currentToken ? currentToken.substring(0, 30) + '...' : 'NULL'));
            
            try {
                const response = await fetch('https://g1laj6w194.execute-api.us-east-1.amazonaws.com/prod/files', {
                    method: 'GET',
                    headers: headers
                });
                
                log('Response Status: ' + response.status);
                log('Response Headers:');
                for (let [key, value] of response.headers.entries()) {
                    log('- ' + key + ': ' + value);
                }
                
                if (response.ok) {
                    const data = await response.json();
                    log('✅ Sucesso: ' + data.files.length + ' arquivos');
                } else {
                    const errorText = await response.text();
                    log('❌ Erro: ' + errorText);
                }
                
            } catch (error) {
                log('❌ Network Error: ' + error.message);
            }
        }
    </script>
</body>
</html>