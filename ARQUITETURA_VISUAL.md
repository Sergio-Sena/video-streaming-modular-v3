# 🎨 **DIAGRAMAS VISUAIS DA ARQUITETURA**

## 🏗️ **ARQUITETURA GERAL**

```
                    ┌─────────────────────────────────────────────────────┐
                    │                   USUÁRIO                           │
                    │              (Browser/Mobile)                       │
                    └─────────────────┬───────────────────────────────────┘
                                      │
                                      │ HTTPS
                                      ▼
                    ┌─────────────────────────────────────────────────────┐
                    │                CLOUDFRONT CDN                       │
                    │         (videos.sstechnologies-cloud.com)           │
                    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
                    │  │   Cache     │  │   Cache     │  │   Cache     │ │
                    │  │   US-East   │  │   EU-West   │  │   AP-South  │ │
                    │  └─────────────┘  └─────────────┘  └─────────────┘ │
                    └─────────────────┬───────────────────────────────────┘
                                      │
                    ┌─────────────────┼───────────────────────────────────┐
                    │                 │                                   │
                    ▼                 ▼                                   ▼
        ┌─────────────────┐  ┌─────────────────┐              ┌─────────────────┐
        │   S3 FRONTEND   │  │   API GATEWAY   │              │   S3 VIDEOS     │
        │                 │  │                 │              │                 │
        │ ┌─────────────┐ │  │ ┌─────────────┐ │              │ ┌─────────────┐ │
        │ │ index.html  │ │  │ │ /auth       │ │              │ │ videos/     │ │
        │ │ modules/    │ │  │ │ /videos     │ │              │ │ converted/  │ │
        │ │ styles/     │ │  │ └─────────────┘ │              │ └─────────────┘ │
        │ └─────────────┘ │  └─────────┬───────┘              └─────────────────┘
        └─────────────────┘            │
                                       │
                                       ▼
                          ┌─────────────────────────────────┐
                          │        LAMBDA FUNCTIONS         │
                          │                                 │
                          │ ┌─────────────┐ ┌─────────────┐ │
                          │ │    AUTH     │ │   VIDEOS    │ │
                          │ │  (Simple)   │ │  (Simple)   │ │
                          │ └─────────────┘ └─────────────┘ │
                          └─────────────────────────────────┘
                                       │
                                       ▼
                          ┌─────────────────────────────────┐
                          │      SECRETS MANAGER            │
                          │                                 │
                          │ ┌─────────────────────────────┐ │
                          │ │ video-streaming-user        │ │
                          │ │ - email                     │ │
                          │ │ - password (bcrypt)         │ │
                          │ │ - jwtSecret                 │ │
                          │ └─────────────────────────────┘ │
                          └─────────────────────────────────┘
```

## 🔄 **FLUXO DE CONVERSÃO AUTOMÁTICA**

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   UPLOAD    │    │ DETECÇÃO    │    │ CONVERSÃO   │    │  CLEANUP    │
│             │    │             │    │             │    │             │
│ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │
│ │ User    │ │    │ │ Lambda  │ │    │ │MediaConv│ │    │ │ Lambda  │ │
│ │ Selects │ │    │ │ Trigger │ │    │ │ Job     │ │    │ │ Cleanup │ │
│ │ .avi    │ │    │ │         │ │    │ │         │ │    │ │         │ │
│ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │
└──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘
       │                  │                  │                  │
       ▼                  ▼                  ▼                  ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│S3 Temp      │    │S3 Event     │    │Convert      │    │Delete Temp  │
│Bucket       │    │Notification │    │.avi → .mp4  │    │File         │
│             │    │             │    │             │    │             │
│videos/      │───►│ObjectCreated│───►│Input: Temp  │───►│Success: Del │
│file.avi     │    │*            │    │Output: Main │    │file.avi     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                             │
                                             ▼
                                   ┌─────────────┐
                                   │S3 Principal │
                                   │Bucket       │
                                   │             │
                                   │converted/   │
                                   │file.mp4     │
                                   └─────────────┘
```

## 📊 **FLUXO DE DADOS DETALHADO**

### **1. AUTENTICAÇÃO**
```
Frontend                API Gateway              Lambda Auth
   │                        │                        │
   │ POST /auth             │                        │
   │ {email, password}      │                        │
   ├───────────────────────►│                        │
   │                        │ Invoke                 │
   │                        ├───────────────────────►│
   │                        │                        │ Validate
   │                        │                        │ Credentials
   │                        │                        │
   │                        │ {success, token}       │
   │                        │◄───────────────────────┤
   │ Store token            │                        │
   │◄───────────────────────┤                        │
   │                        │                        │
```

### **2. UPLOAD MP4 (Direto)**
```
Frontend                Videos Lambda             S3 Principal
   │                        │                        │
   │ POST /videos           │                        │
   │ {fileName: "vid.mp4"}  │                        │
   ├───────────────────────►│                        │
   │                        │ Detect: MP4            │
   │                        │ Generate URL           │
   │                        │ Target: Principal      │
   │                        │                        │
   │ {uploadUrl}            │                        │
   │◄───────────────────────┤                        │
   │                        │                        │
   │ PUT uploadUrl          │                        │
   ├─────────────────────────────────────────────────►│
   │                        │                        │ Store
   │ Success                │                        │ video.mp4
   │◄─────────────────────────────────────────────────┤
```

### **3. UPLOAD OUTROS FORMATOS (Conversão)**
```
Frontend            Videos Lambda         S3 Temp           MediaConvert        S3 Principal
   │                    │                   │                    │                   │
   │ POST /videos       │                   │                    │                   │
   │ {fileName:"v.avi"} │                   │                    │                   │
   ├───────────────────►│                   │                    │                   │
   │                    │ Detect: AVI       │                    │                   │
   │                    │ Target: Temp      │                    │                   │
   │                    │                   │                    │                   │
   │ {uploadUrl}        │                   │                    │                   │
   │◄───────────────────┤                   │                    │                   │
   │                    │                   │                    │                   │
   │ PUT uploadUrl      │                   │                    │                   │
   ├─────────────────────────────────────────►│                    │                   │
   │                    │                   │ S3 Event           │                   │
   │                    │                   ├───────────────────►│                   │
   │                    │                   │                    │ Convert           │
   │                    │                   │                    │ AVI → MP4         │
   │                    │                   │                    │                   │
   │                    │                   │                    │ Output MP4        │
   │                    │                   │                    ├──────────────────►│
   │                    │                   │ Delete AVI         │                   │
   │                    │                   │◄───────────────────┤                   │
   │ MP4 Available      │                   │                    │                   │
   │◄───────────────────────────────────────────────────────────────────────────────┤
```

## 🔧 **COMPONENTES TÉCNICOS**

### **LAMBDA FUNCTIONS**
```
┌─────────────────────────────────────────────────────────────────────┐
│                           LAMBDA ECOSYSTEM                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │
│  │   AUTH SERVICE  │  │  VIDEO SERVICE  │  │ CONVERT TRIGGER │     │
│  │                 │  │                 │  │                 │     │
│  │ • Validate      │  │ • Generate URLs │  │ • S3 Events     │     │
│  │ • Generate JWT  │  │ • Route by type │  │ • Create MC Job │     │
│  │ • CORS Headers  │  │ • Multipart     │  │ • Job Config    │     │
│  │                 │  │ • List videos   │  │                 │     │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘     │
│           │                     │                     │             │
│           │                     │                     │             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │
│  │ SECRETS MANAGER │  │   S3 BUCKETS    │  │  MEDIACONVERT   │     │
│  │                 │  │                 │  │                 │     │
│  │ • Credentials   │  │ • Principal     │  │ • Job Queue     │     │
│  │ • JWT Secret    │  │ • Temp          │  │ • Conversion    │     │
│  │ • Encrypted     │  │ • Versioning    │  │ • Notifications │     │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### **STORAGE ARCHITECTURE**
```
┌─────────────────────────────────────────────────────────────────────┐
│                         STORAGE LAYER                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    S3 PRINCIPAL BUCKET                      │   │
│  │              video-streaming-sstech-eaddf6a1                │   │
│  │                                                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │
│  │  │  frontend/  │  │   videos/   │  │ converted/  │        │   │
│  │  │             │  │             │  │             │        │   │
│  │  │ • HTML      │  │ • Direct    │  │ • From MC   │        │   │
│  │  │ • CSS       │  │   MP4       │  │ • Processed │        │   │
│  │  │ • JS        │  │ • Original  │  │ • Ready     │        │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│                                │                                    │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    S3 TEMP BUCKET                           │   │
│  │                 video-temp-conversion                       │   │
│  │                                                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │
│  │  │   videos/   │  │  Triggers   │  │ Lifecycle   │        │   │
│  │  │             │  │             │  │             │        │   │
│  │  │ • AVI       │  │ • Lambda    │  │ • Auto Del  │        │   │
│  │  │ • MOV       │  │ • MC Jobs   │  │ • 7 days    │        │   │
│  │  │ • MKV       │  │ • Events    │  │ • Cleanup   │        │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 🌐 **REDE E DISTRIBUIÇÃO**

```
                    ┌─────────────────────────────────────────┐
                    │              INTERNET                   │
                    └─────────────────┬───────────────────────┘
                                      │
                    ┌─────────────────────────────────────────┐
                    │            ROUTE 53 DNS                 │
                    │  videos.sstechnologies-cloud.com        │
                    │           ↓                             │
                    │  d2we88koy23cl4.cloudfront.net          │
                    └─────────────────┬───────────────────────┘
                                      │
                    ┌─────────────────────────────────────────┐
                    │          CLOUDFRONT CDN                 │
                    │                                         │
                    │ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
                    │ │US-East-1│ │EU-West-1│ │AP-South │   │
                    │ │Edge Loc │ │Edge Loc │ │Edge Loc │   │
                    │ └─────────┘ └─────────┘ └─────────┘   │
                    └─────────────────┬───────────────────────┘
                                      │
                    ┌─────────────────────────────────────────┐
                    │            US-EAST-1                    │
                    │                                         │
                    │ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
                    │ │   S3    │ │ Lambda  │ │API Gate │   │
                    │ │ Buckets │ │Functions│ │  way    │   │
                    │ └─────────┘ └─────────┘ └─────────┘   │
                    │                                         │
                    │ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
                    │ │MediaConv│ │Secrets  │ │CloudWtch│   │
                    │ │  ert    │ │ Manager │ │  Logs   │   │
                    │ └─────────┘ └─────────┘ └─────────┘   │
                    └─────────────────────────────────────────┘
```

---

**📊 Esta documentação visual complementa a documentação técnica completa e fornece uma visão clara da arquitetura e fluxos do sistema.**